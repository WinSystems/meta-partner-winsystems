From d9647c3dc5aeb2949997d77adb067d2d39befc8e Mon Sep 17 00:00:00 2001
From: TJ Smith <tjsmith@winsystems.com>
Date: Wed, 27 Sep 2023 20:25:46 +0000
Subject: [PATCH] Ram size fix when optee region does not overlap

---
 arch/arm/mach-imx/imx8m/soc.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/arm/mach-imx/imx8m/soc.c b/arch/arm/mach-imx/imx8m/soc.c
index f30e957465f..df62265bd11 100644
--- a/arch/arm/mach-imx/imx8m/soc.c
+++ b/arch/arm/mach-imx/imx8m/soc.c
@@ -278,7 +278,9 @@ int dram_init_banksize(void)
 	}
 
 	gd->bd->bi_dram[bank].start = PHYS_SDRAM;
-	if (rom_pointer[1]) {
+
+	/* if optee enabled and optee start overlaps ddr bank address range */
+	if (rom_pointer[1] && ((PHYS_SDRAM + sdram_b1_size) > rom_pointer[0])) {
 		phys_addr_t optee_start = (phys_addr_t)rom_pointer[0];
 		phys_size_t optee_size = (size_t)rom_pointer[1];
 
